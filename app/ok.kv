#:kivy 2.1.0

<ItemDrawer>:
    theme_text_color: "Custom"
    on_release: 
        self.parent.set_color_item(self)
        app.root.ids.screen_manager.current = root.screen
        app.root.ids.nav_drawer.set_state("close")
        app.root.ids.screen_manager.transition.direction = 'left'

    IconLeftWidget:
        id: icon
        icon: root.icon
        theme_text_color: "Custom"
        text_color: root.text_color 

<ContentNavigationDrawer>:
    orientation: "vertical"
    padding: "8dp"
    spacing: "8dp"
    AnchorLayout:
        anchor_x: "left"
        size_hint_y: None
        height: avatar.height

        Image:
            id: avatar
            size_hint: None, None
            size: "56dp", "56dp"
            source: "data/logo/kivy-icon-256.png"

    MDLabel:
        text: "OpenKardio"
        font_style: "Button"
        adaptive_height: True

    MDLabel:
        text: "openkardio@gmail.com"
        font_style: "Caption"
        adaptive_height: True

    ScrollView:
        DrawerList:
            id: md_list

<OKListItem>:
    on_release:
        app.root.ids.screen_manager.get_screen(root.screen).title = root.text
        app.root.ids.screen_manager.get_screen(root.screen).object_id = root.object_id
        app.root.ids.screen_manager.current = root.screen
        app.root.ids.screen_manager.transition.direction = 'left'
    IconLeftWidget:
        icon: root.icon

<PatientList>:

<PatientDetail>:
    orientation: 'vertical'
    adaptive_height: True
    padding: "8dp"
    spacing: "8dp"
    OKCard:
        orientation: "vertical"
        elevation: 8
        padding: "8dp"
        spacing: "8dp"
        size_hint: 0.9, 0.45
        pos_hint: {"center_x": .5, "center_y": .5}
        md_bg_color: 0.2, 0.1, 0.5, 0.8
        border_radius: "8dp"
        MDLabel:
            text: "Información General"
            theme_text_color: "Secondary"
            font_style: "H6"
            size_hint_y: None
            height: self.texture_size[1]
        MDBoxLayout:
            orientation: "horizontal"
            adaptive_height: True
            padding: "8dp"
            spacing: "8dp"
            MDIcon:
                halign: "center"
                icon: root.sex_icon
                size_hint: 0.2, None
                height: "64dp"
            MDLabel:
                id: name
                size_hint_y: 1
                font_style: "Subtitle2"
                valign: "center"
                halign: "left"
        MDSeparator:
            height: "1dp"
        MDLabel:
            id: age
            size_hint_y: None
            height: self.texture_size[1]
        MDLabel:
            id: identification
            size_hint_y: None
            height: self.texture_size[1]
        MDLabel:
            id: record
            size_hint_y: None
            height: self.texture_size[1]
        MDLabel:
            id: address
            size_hint_y: None
            height: self.texture_size[1]
        MDLabel:
            id: contact
            size_hint_y: None
            height: self.texture_size[1]
    Widget:

<FormField>:
    orientation: 'horizontal'
    adaptive_height: True
    padding: "8dp"
    spacing: "8dp"
    MDLabel:
        text: root.label
        size_hint_x: 0.4
        halign: "right"
        valign: "bottom"

<PatientForm>:
    orientation: 'vertical'
    padding: ["60dp", "8dp", "80dp", "8dp"]
    spacing: "8dp"
    adaptive_height: True
    MDLabel:
        text: root.header
        halign: "center"
        font_style: "H6"
    FormField:
        id: first_name
        label: "Nombres:"
        MDTextField:
            text: self.parent.text
            hint_text: "Nombres del paciente"
            multiline: False
            error: self.parent.error
            required: True
            helper_text_mode: "on_error"
            helper_text: "Requerido"
            on_text: self.parent.value = self.text
    FormField:
        id: last_name
        label: "Apellidos:"
        MDTextField:
            text: self.parent.text
            hint_text: "Apellidos del paciente"
            multiline: False
            error: self.parent.error
            required: True
            helper_text_mode: "on_error"
            helper_text: "Requerido"
            on_text: self.parent.value = self.text
    FormField:
        id: address
        label: "Domicilio:"
        MDTextField:
            text: self.parent.text
            hint_text: "Dirección convencional"
            multiline: False
            on_text: self.parent.value = self.text
    FormField:
        id: identification
        label: "Cédula:"
        MDTextField:
            text: self.parent.text
            hint_text: "Cédula de identidad"
            multiline: False
            max_text_length: 16
            min_text_length: 14
            on_text: self.parent.value = self.text
    FormField:
        id: sex
        label: "Sexo:"
        MDTextField:
            text: self.parent.text
            hint_text: "Seleccione el sexo presionando aquí"
            multiline: False
            required: True
            error: self.parent.error
            helper_text_mode: "on_error"
            helper_text: "Requerido"
            icon_right: "arrow-down-drop-cirle-outline"
            on_focus: if self.focus: app.root.ids.patient_form.sex_menu.open()
            on_text: self.parent.value = self.text[0] if len(self.text) else ""
    FormField:
        id: birth_date
        label: "Fecha de nacimiento:"
        MDTextField:
            text: self.parent.text
            hint_text: "Seleccione la fecha (dd/mm/aaaa)*"
            multiline: False
            required: True
            helper_text_mode: "on_error"
            helper_text: "Requerido"
            icon_right: "calendar"
            on_focus: if self.focus: root.show_date_picker()
    FormField:
        id: record
        label: "Expediente:"
        MDTextField:
            text: self.parent.text
            hint_text: "Ingrese número de expediente*"
            multiline: False
            required: True
            helper_text_mode: "on_error"
            helper_text: "Requerido"
            on_text: self.parent.value = self.text
    FormField:
        id: med_conditions
        label: "Condiciones médicas:"
        MDTextField:
            text: self.parent.text
            hint_text: "Ingrese padecimientos del paciente"
            multiline: True
            on_text: self.parent.value = self.text
    FormField:
        id: emergency_contact
        label: "Contacto de emergencia:"
        MDTextField:
            text: self.parent.text
            hint_text: "Ingrese nombre, parentesco y número de teléfono"
            multiline: True
            on_text: self.parent.value = self.text
    MDBoxLayout:
        orientation: 'horizontal'
        adaptive_height: True
        padding: "8dp"
        spacing: "8dp"
        Widget:
        MDRaisedButton:
            text: "OK"
            on_release: 
                app.root.ids.patient_detail.populate(root.save_form())
                app.root.ids.screen_manager.current = "patient_detail_view"
        MDFlatButton:
            text: "CANCEL"
            on_release: app.go_back("patient_list_view")
<ToolbarScreen>:
    MDBoxLayout:
        orientation: 'vertical'
        MDTopAppBar:
            title: root.title
            pos_hint: {'top':1.0}
            elevation: "8dp"
            left_action_items: root.action_items
        MDBoxLayout:
            id: container
            orientation: 'vertical'
            padding: "8dp"
            spacing: "8dp"

MDNavigationLayout:
    ScreenManager:
        id: screen_manager
        ToolbarScreen:
            name: "homescreen"
            title: "ABC"
            action_items: [['menu', lambda x: app.root.ids.nav_drawer.set_state("open")]]
            MDLabel:
                id: out
                halign: "center"
            MDLabel:
                text: "Home 1"
                halign: "center"
            MDRaisedButton:
                text: "Create Random Object"
                on_release: app.create_obj()

        ToolbarScreen:
            name: "user_detail_view"
            title: "Usuario"
            action_items: [['menu', lambda x: app.root.ids.nav_drawer.set_state("open")]]
        ToolbarScreen:
            name: "ekg_list_view"
            title: "Exámenes"
            action_items: [['menu', lambda x: app.root.ids.nav_drawer.set_state("open")]]
            on_enter: app.root.ids.exam_list.populate()
            ScrollView:
                ExamList:
                    id: exam_list
            MDFloatingActionButton:
                icon: "plus-circle-outline"
                md_bg_color: app.theme_cls.accent_dark
                pos_hint: {'center_x':0.9, 'center_y':0.1}
                on_release: 
                    screen_manager.current = 'ekg_create_view'
                    screen_manager.transition.direction = 'left'
        ToolbarScreen:
            name: "ekg_detail_view"
            title: "View ekg"
            action_items: [['arrow-left', lambda *args : app.go_back("ekg_list_view")]]
            MDGridLayout:
                id: ekg_info
                md_bg_color: app.theme_cls.primary_light
                adaptive_height: True
                cols: 2
                padding: [8, 8]
                spacing: [8, 8]
                row_force_default: True
                row_default_height: 32
                MDLabel:
                    text: "texto 1"
                MDLabel:
                    text: "texto 2"
                MDLabel:
                    text: "texto 3"
                MDLabel:
                    text: "texto 4"
        ToolbarScreen:
            name: "ekg_create_view"
            title: "Nuevo EKG"
            action_items: [['arrow-left', lambda *args : app.go_back("ekg_list_view")]]
            MDBoxLayout:
                orientation: 'horizontal'
                size_hint_y: 0.4
                MDBoxLayout:
                    orientation: 'vertical'
                    padding: 8
                    spacing: 8
                    MDLabel:
                        text: "texto"
                    MDLabel:
                        text: "texto"
                MDBoxLayout:
                    orientation: 'vertical'
                    padding: 8
                    spacing: 8
                    MDLabel:
                        text: "texto"
                    MDLabel:
                        text: "texto"
            MDBoxLayout:
                orientation: 'vertical'
                size_hint_y: 1
                ScrollView:
                    do_scroll_y: False
                    effect_cls: 'ScrollEffect'
                    Plot:
                        id: ekg_new
                        size_hint_x: None
                        size_hint_y: None
                        height: self.parent.height
                        width: self.parent.width 
                        MDBoxLayout:
                            orientation: 'horizontal'
                            size_hint_y: 0.2
                            spacing: 8
                            MDLabel:
                                text: "texto"
                            MDLabel:
                                text: "texto"
            MDBoxLayout:
                orientation: 'horizontal'
                size_hint_y: 0.2
                size_hint_x: None
                padding: self.width*0.1
                spacing: self.width*0.15
                MDRaisedButton:
                    text: "FLATBUTTON2"
                    pos_hint: {'center_y': 0.5}
                    on_release: ekg_new.clear_ekg()
                MDRaisedButton:
                    text: "FLATBUTTON3"
                    pos_hint: {'center_y': 0.5}
                    on_release: setattr(ekg_new, 'run_samples', True)
        ToolbarScreen:
            name: "patient_list_view"
            title: "Pacientes"
            action_items: [['menu', lambda x: app.root.ids.nav_drawer.set_state("open")]]
            on_enter: app.root.ids.patient_list.populate()
            ScrollView:
                PatientList:
                    id: patient_list
            MDFloatingActionButton:
                icon: "plus-circle-outline"
                md_bg_color: app.theme_cls.accent_dark
                pos_hint: {'center_x':0.9, 'center_y':0.1}
                on_release: 
                    screen_manager.current = 'patient_create_view'
                    screen_manager.transition.direction = 'left'
        ToolbarScreen:
            name: "patient_detail_view"
            title: "View Patient"
            action_items: [['arrow-left', lambda *args : app.go_back("patient_list_view")]]
            on_enter: app.root.ids.patient_detail.populate(self.object_id)
            PatientDetail:
                id: patient_detail
        ToolbarScreen:
            name: "patient_create_view"
            title: "Nuevo paciente"
            action_items: [['arrow-left', lambda *args : app.go_back("patient_list_view")]]
            ScrollView:
                PatientForm:
                    id: patient_form
                    header: "Ingrese información solicitada"
        ToolbarScreen:
            name: "config"
            title: "Configuración"
            action_items: [['menu', lambda x: app.root.ids.nav_drawer.set_state("open")]]
        ToolbarScreen:
            name: "help"
            title: "Ayuda"
            action_items: [['menu', lambda x: app.root.ids.nav_drawer.set_state("open")]]
    MDNavigationDrawer:
        id: nav_drawer
        ContentNavigationDrawer:
            id: content_drawer